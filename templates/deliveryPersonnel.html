{% extends "menu.html" %} {% block title %}Delivery Personnel Dashboard{%
endblock %} {%block content %}
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<style>
  body {
    font-family: "Arial", sans-serif;
    background-color: #f4f5f7;
  }

  .dashboard-container {
    margin-top: 50px;
    background-color: #fff;
    padding: 20px 40px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  h4 {
    border-bottom: 2px solid #007bff;
    padding-bottom: 10px;
    margin-bottom: 20px;
    margin-top: 20px;
  }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
  function deliveryOrder(orderId, customerId) {
    console.log(orderId);
    $.ajax({
      url: "/getDelivery",
      type: "POST",
      contentType: "application/json",
      data: JSON.stringify({
        orderID: orderId,
        customerID: customerId,
      }),
      success: function (response) {
        alert(response);
        location.reload();
      },
    });
  }
  function deliveryOrderConfirmed(orderId, customerId) {
    if (confirm("are you sure you have delivered the order?")) {
      $.ajax({
        url: "/getDelivery",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify({
          orderID: orderId,
          customerID: customerId,
        }),
        success: function (response) {
          alert(response);
          location.reload();
        },
      });
    }
  }
</script>
<div class="container dashboard-container">
  <!-- Tab Navigation -->
  <ul class="nav nav-tabs" id="myTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <a
        class="nav-link active"
        id="deliveries-tab"
        data-bs-toggle="tab"
        href="#deliveries"
        role="tab"
        >Assigned Deliveries</a
      >
    </li>
    <li class="nav-item" role="presentation">
      <a
        class="nav-link"
        id="earnings-tab"
        data-bs-toggle="tab"
        href="#earnings"
        role="tab"
        >Track Earnings</a
      >
    </li>
    <li class="nav-item" role="presentation">
      <a
        class="nav-link"
        id="message-tab"
        data-bs-toggle="tab"
        href="#message"
        role="tab"
        >Send a Message</a
      >
    </li>
  </ul>
  <!-- Tab Content -->
  <div class="tab-content mt-4" id="myTabContent">
    <!-- Assigned Deliveries Content -->
    <div class="tab-pane fade show active" id="deliveries" role="tabpanel">
      <div class="mb-5">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Customer Name</th>
                <th>Ordered Dishes</th>
                <th>Address</th>
                <th>Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Sample order details -->
              {% for order in orderFoods %} {%for customerOrder in order.food%}
              {%if customerOrder.deliveryPersonID == id%}
              <tr>
                <td>{{customerOrder.orderId}}</td>
                <td>
                  {%for user in customers%}{%if user.id ==
                  order.customer%}{{user.name}}{%endif%}{%endfor%}
                </td>
                <td>
                  {%for food in customerOrder.orderFood%} {%for item in foods%}
                  {%if item.id == food.foodId%}
                  <p>{{item.name}} x {{food.quantity}}</p>
                  {%endif%} {%endfor%} {%endfor%}
                </td>
                <td>{%for user in customers%}{%if user.id ==
                  order.customer%}{{user.address}}{%endif%}{%endfor%}</td>
                  <td>{{customerOrder.orderDate}}
                  </td>
                <td>
                  <span class="badge bg-warning text-dark"
                    >{{customerOrder.status}}</span
                  >
                </td>
                <td>
                  {%if customerOrder.status == 'sentDelivery'%}
                  <button
                    class="btn btn-sm btn-success setDeliveryPerson"
                    onclick="deliveryOrder({{customerOrder.orderId}}, {%for user in customers%}{%if user.id == order.customer%}'{{user.id}}'{%endif%}{%endfor%})"
                  >
                    got the order
                  </button>
                  {%elif customerOrder.status == 'getDelivery'%}
                  <button
                    class="btn btn-sm btn-success"
                    onclick="deliveryOrderConfirmed({{customerOrder.orderId}}, {%for user in customers%}{%if user.id == order.customer%}'{{user.id}}'{%endif%}{%endfor%})"
                  >
                    Delivered
                  </button>
                  {%endif%}
                </td>
              </tr>
              {%endif%}{%endfor%} {%endfor%}
              <!-- Add more orders as needed -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <!-- Earnings Section -->
    <div class="tab-pane fade" id="earnings" role="tabpanel">
      <div class="earnings-card mb-5">
        <p class="text-muted">Select a period to display earnings</p>
        <!-- Date Range Picker -->
        <form action="your-earnings-action-url-here" method="post" class="mb-3">
          <div class="row">
            <div class="col-md-5">
              <label for="startDate" class="form-label">From</label>
              <input
                type="date"
                class="form-control"
                id="startDate"
                name="startDate"
              />
            </div>
            <div class="col-md-5">
              <label for="endDate" class="form-label">To</label>
              <input
                type="date"
                class="form-control"
                id="endDate"
                name="endDate"
              />
            </div>
            <div class="col-md-2 d-flex align-items-end">
              <button type="submit" class="btn btn-primary w-100">
                Display Earnings
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
    <!-- Message Content -->
    <div class="tab-pane fade" id="message" role="tabpanel">
      <div class="mb-5">
        <p class="text-muted">
          Need help or have feedback? Send us a message below.
        </p>
        <form>
          <label for="message" class="form-label">Message</label>
          <textarea class="form-control" id="message" rows="3"></textarea>
          <button type="submit" class="btn btn-primary mt-2">
            Send Message
          </button>
        </form>
      </div>
    </div>
  </div>
  <!-- Bootstrap 5 JS, Popper.js -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  {% endblock %}
</div>
